<!DOCTYPE html>
<html lang="zh-Hant-CN">
<head>
<meta charset="UTF-8">
<title>XA Transaction SQL Statements</title>
<link href="../docs.css" rel="stylesheet">
</head>
<body>

        
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="xa-statements"></a>13.3.7.1&nbsp;XA Transaction SQL Statements</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm45852576600176"></a><a class="indexterm" name="idm45852576599136"></a><a class="indexterm" name="idm45852576597648"></a><a class="indexterm" name="idm45852576596576"></a><a class="indexterm" name="idm45852576595088"></a><a class="indexterm" name="idm45852576594016"></a><a class="indexterm" name="idm45852576592528"></a><a class="indexterm" name="idm45852576591456"></a><a class="indexterm" name="idm45852576589968"></a><a class="indexterm" name="idm45852576588896"></a><a class="indexterm" name="idm45852576587408"></a><a class="indexterm" name="idm45852576586336"></a><a class="indexterm" name="idm45852576584848"></a><a class="indexterm" name="idm45852576583376"></a><p>
        To perform XA transactions in MySQL, use the following
        statements:
      </p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">XA {START|BEGIN} <em class="replaceable">xid</em> [JOIN|RESUME]

XA END <em class="replaceable">xid</em> [SUSPEND [FOR MIGRATE]]

XA PREPARE <em class="replaceable">xid</em>

XA COMMIT <em class="replaceable">xid</em> [ONE PHASE]

XA ROLLBACK <em class="replaceable">xid</em>

XA RECOVER [CONVERT XID]</code></pre><p>
        For <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        START</code></a>, the <code class="literal">JOIN</code> and
        <code class="literal">RESUME</code> clauses are recognized but have no
        effect.
      </p><p>
        For <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        END</code></a> the <code class="literal">SUSPEND [FOR MIGRATE]</code>
        clause is recognized but has no effect.
      </p><p>
        Each XA statement begins with the <code class="literal">XA</code> keyword,
        and most of them require an <em class="replaceable"><code>xid</code></em>
        value. An <em class="replaceable"><code>xid</code></em> is an XA transaction
        identifier. It indicates which transaction the statement applies
        to. <em class="replaceable"><code>xid</code></em> values are supplied by the
        client, or generated by the MySQL server. An
        <em class="replaceable"><code>xid</code></em> value has from one to three
        parts:
      </p><pre class="programlisting copytoclipboard language-none one-line"><code class="language-none"><em class="replaceable">xid</em>: <em class="replaceable">gtrid</em> [, <em class="replaceable">bqual</em> [, <em class="replaceable">formatID</em> ]]</code></pre><p>
        <em class="replaceable"><code>gtrid</code></em> is a global transaction
        identifier, <em class="replaceable"><code>bqual</code></em> is a branch
        qualifier, and <em class="replaceable"><code>formatID</code></em> is a number
        that identifies the format used by the
        <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> values. As indicated by the
        syntax, <em class="replaceable"><code>bqual</code></em> and
        <em class="replaceable"><code>formatID</code></em> are optional. The default
        <em class="replaceable"><code>bqual</code></em> value is <code class="literal">''</code>
        if not given. The default <em class="replaceable"><code>formatID</code></em>
        value is 1 if not given.
      </p><p>
        <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> must be string literals, each
        up to 64 bytes (not characters) long.
        <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> can be specified in several
        ways. You can use a quoted string (<code class="literal">'ab'</code>), hex
        string (<code class="literal">X'6162'</code>, <code class="literal">0x6162</code>),
        or bit value
        (<code class="literal">b'<em class="replaceable"><code>nnnn</code></em>'</code>).
      </p><p>
        <em class="replaceable"><code>formatID</code></em> is an unsigned integer.
      </p><p>
        The <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> values are interpreted in bytes
        by the MySQL server's underlying XA support routines. However,
        while an SQL statement containing an XA statement is being
        parsed, the server works with some specific character set. To be
        safe, write <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> as hex strings.
      </p><p>
        <em class="replaceable"><code>xid</code></em> values typically are generated by
        the Transaction Manager. Values generated by one TM must be
        different from values generated by other TMs. A given TM must be
        able to recognize its own <em class="replaceable"><code>xid</code></em> values
        in a list of values returned by the
        <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        RECOVER</code></a> statement.
      </p><p>
        <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA START
        <em class="replaceable"><code>xid</code></em></code></a> starts an XA
        transaction with the given <em class="replaceable"><code>xid</code></em> value.
        Each XA transaction must have a unique
        <em class="replaceable"><code>xid</code></em> value, so the value must not
        currently be used by another XA transaction. Uniqueness is
        assessed using the <em class="replaceable"><code>gtrid</code></em> and
        <em class="replaceable"><code>bqual</code></em> values. All following XA
        statements for the XA transaction must be specified using the
        same <em class="replaceable"><code>xid</code></em> value as that given in the
        <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        START</code></a> statement. If you use any of those statements
        but specify an <em class="replaceable"><code>xid</code></em> value that does
        not correspond to some existing XA transaction, an error occurs.
      </p><p>
        One or more XA transactions can be part of the same global
        transaction. All XA transactions within a given global
        transaction must use the same <em class="replaceable"><code>gtrid</code></em>
        value in the <em class="replaceable"><code>xid</code></em> value. For this
        reason, <em class="replaceable"><code>gtrid</code></em> values must be globally
        unique so that there is no ambiguity about which global
        transaction a given XA transaction is part of. The
        <em class="replaceable"><code>bqual</code></em> part of the
        <em class="replaceable"><code>xid</code></em> value must be different for each
        XA transaction within a global transaction. (The requirement
        that <em class="replaceable"><code>bqual</code></em> values be different is a
        limitation of the current MySQL XA implementation. It is not
        part of the XA specification.)
      </p><p>
        The <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        RECOVER</code></a> statement returns information for those XA
        transactions on the MySQL server that are in the
        <code class="literal">PREPARED</code> state. (See
        <a class="xref" href="xa-states.html" title="13.3.7.2&nbsp;XA Transaction States">Section&nbsp;13.3.7.2, “XA Transaction States”</a>.) The output includes a row for each
        such XA transaction on the server, regardless of which client
        started it.
      </p><p>
        <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        RECOVER</code></a> output rows look like this (for an example
        <em class="replaceable"><code>xid</code></em> value consisting of the parts
        <code class="literal">'abc'</code>, <code class="literal">'def'</code>, and
        <code class="literal">7</code>):
      </p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">mysql&gt; XA RECOVER;
+----------+--------------+--------------+--------+
| formatID | gtrid_length | bqual_length | data   |
+----------+--------------+--------------+--------+
|        7 |            3 |            3 | abcdef |
+----------+--------------+--------------+--------+</code></pre><p>
        The output columns have the following meanings:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">formatID</code> is the
            <em class="replaceable"><code>formatID</code></em> part of the transaction
            <em class="replaceable"><code>xid</code></em>
          </p></li><li class="listitem"><p>
            <code class="literal">gtrid_length</code> is the length in bytes of
            the <em class="replaceable"><code>gtrid</code></em> part of the
            <em class="replaceable"><code>xid</code></em>
          </p></li><li class="listitem"><p>
            <code class="literal">bqual_length</code> is the length in bytes of
            the <em class="replaceable"><code>bqual</code></em> part of the
            <em class="replaceable"><code>xid</code></em>
          </p></li><li class="listitem"><p>
            <code class="literal">data</code> is the concatenation of the
            <em class="replaceable"><code>gtrid</code></em> and
            <em class="replaceable"><code>bqual</code></em> parts of the
            <em class="replaceable"><code>xid</code></em>
</p></li></ul>
</div>
<p>
        XID values may contain nonprintable characters. As of MySQL
        5.7.5, <a class="link" href="xa-statements.html" title="13.3.7.1&nbsp;XA Transaction SQL Statements"><code class="literal">XA
        RECOVER</code></a> permits an optional <code class="literal">CONVERT
        XID</code> clause so that clients can request XID values in
        hexadecimal.
</p>
</div>
<br>
        
</body>
</html>